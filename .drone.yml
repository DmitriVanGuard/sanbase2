pipeline:
  backend:
    group: build
    image: elixir:1.6.0-alpine
    environment:
      - DATABASE_URL=postgres://postgres:password@postgres:5432/postgres
      - INFLUXDB_HOST=influxdb
    commands:
      - apk add --update git postgresql-client
      - mix local.hex --force
      - mix local.rebar --force
      - mix deps.get
      - mix deps.compile
      - mix test
  frontend:
    group: build
    image: node:latest
    commands:
      - cd app
      - yarn
      - yarn test --ci

services:
  postgres:
    image: postgres:9.6-alpine
  influxdb:
    image: influxdb:1.3-alpine
